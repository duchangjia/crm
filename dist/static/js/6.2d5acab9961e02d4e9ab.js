webpackJsonp([6],{"5BPW":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l,s=a("a3Yh"),i=a.n(s),r=a("aA9S"),n=a.n(r),o=a("4YfN"),c=a.n(o),d=a("9rMa"),u=a("s0MJ"),v=a("iA2B"),m=(l={data:function(){return{areaoptions:[],areaProps:{value:"id",label:"city",children:"cities"},showInvalid:!1,invalidData:{isConnect:"",remark:"",isValid:0,followMode:""},invalidType:[{id:0,label:"接通后20s内挂断"},{id:1,label:"无人接听"},{id:2,label:"空号"},{id:3,label:"停机/错号"}],EditReturnLis:v.editReturnList,showCallDetail:!1,callRule:{followTimeMinute:[{required:!0,message:"请选择沟通时间"}],backPlan:[{required:!0,message:"请选择回访时间"}],nick:[{required:!0,message:"请填写昵称"}],sex:[{required:!0,message:"请选择性别"}],chanceArea:[{required:!0,message:"请选择地域"}]},invalidRule:{reason:[{required:!0,message:"请选择无效原因"}]},CallFormData:{followTimeMinute:Object(u.a)((new Date).getTime()/1e3),followMode:"",remark:"",backPlan:"",backTimeMinute:"",backRemark:"",isValid:1,isConnect:1,chanceArea:[],nick:"",sex:""},contactType:[{label:"手机",value:0},{label:"座机",value:1}],islogin:!1,stuId:0,cardClass:["back_tel","back_tel2","back_wexin","back_qq","back_add"],addAlert:{text:"手机",tel:"",camear:"",weixin:"",QQ:""},dialogFormVisible:!1,contactsName:["手机号码","座机","微信","QQ"],contactsList:[],rules:{tel:[{validator:function(e,t,a){Object(u.c)(t)?a():a(new Error("请输入正确的手机号"))},trigger:"blur"}],camear:[{validator:function(e,t,a){Object(u.d)(t)?a():a(new Error("请输入正确的座机"))},trigger:"blur"}],weixin:[{validator:function(e,t,a){Object(u.f)(t)?a():a(new Error("请输入正确的微信号"))},trigger:"blur"}],QQ:[{validator:function(e,t,a){Object(u.e)(t)?a():a(new Error("请输入正确的QQ"))},trigger:"blur"}]},callId:"",showTip:!1,callMessage:"通话中",btnDisabled:!0}},watch:{$route:"qryStuContact"},created:function(){this.qryStuContact(),this.isloginEvent()}},i()(l,"watch",{studentInfo:function(){var e=this.studentInfo;this.CallFormData.nick=e.nick,this.CallFormData.sex=e.sex,this.CallFormData.chanceArea=[e.provinceIdFk,e.cityIdFk],this.qryArea()}}),i()(l,"computed",c()({},Object(d.d)({userInfo:function(e){return e.user.userInfo},code:function(e){return e.user.code},studentInfo:function(e){return e.workbench.studentInfo}}))),i()(l,"methods",{qryArea:function(e){var t=this;this.API.qryArea({areaId:1}).then(function(e){var a=e.result.map(function(e){return{id:e.id,city:e.province||e.city,cities:[]}});t.areaoptions=a,t.studentInfo.cityIdFk&&t.handleItemChange([t.studentInfo.provinceIdFk])})},handleItemChange:function(e){if(!(e.length>1)&&e.length){var t=this.areaoptions;this.API.qryArea({areaId:e[0]}).then(function(a){t.forEach(function(t){if(t.id==e[0])return a.result[0].city?t.cities=a.result:t.cities="",!1})})}},saveInvalid:function(){var e=this;this.$refs.invalidForm.validate(function(t){if(t){var a=n()({},e.invalidData,{id:e.callId,stuIdFk:e.studentInfo.stuId});e.API.mdfStudentFollowDetail(a).then(function(t){e.$message({type:"success",message:"操作成功!"}),e.showInvalid=!1})}})},saveCallDetail:function(){var e=this;this.$refs.addCallForm.validate(function(t){if(t){var a=e.CallFormData.chanceArea,l=n()({},e.CallFormData,{id:e.callId,stuIdFk:e.studentInfo.stuId,provinceIdFk:a[0],cityIdFk:a[1]||""});e.API.mdfStudentFollowDetail(l).then(function(t){e.$message({type:"success",message:"操作成功!"}),e.showCallDetail=!1})}})},qryStuContact:function(){var e=this;this.stuId=this.$router.currentRoute.query.stuId,this.API.qryStuContact({stuId:this.stuId}).then(function(t){e.contactsList=t.result;e.contactsList.push({name:"添加",urIndex:0,more:[]})}).catch(function(e){console.log(e.message)})},isloginEvent:function(){var e=localStorage.getItem("code");console.log(e),this.islogin=12==e||0==e},_next:function(e){e.urIndex+=1,e.urIndex>=e.more.length?e.urIndex=0:e.urIndex},_add:function(e){e.name&&(this.dialogFormVisible=!0)},playcall:function(e,t){var a=this,l=localStorage.getItem("code"),s=this;0==l||12==l?this.$confirm("确定要拨打电话："+e+"?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.CallFormData.followMode=t.type,a.invalidData.followMode=t.type,a.CallFormData.followTimeMinute=Object(u.a)((new Date).getTime()/1e3),a.API.hangup({userName:a.userInfo.userName,mobile:e,studentId:a.stuId}).then(function(e){a.callId=e.id,a.showTip=!0;var t=20,l=setInterval(function(){t--,s.callMessage="通话中"+t+"s",0===t&&(clearInterval(l),s.btnDisabled=!1,s.callMessage="结束通话")},1e3)})}):this.$message({type:"warning",message:"请先登录呼叫中心!"})},overCall:function(){var e=this;this.$confirm("确定要结束通话？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.API.effective({id:e.callId}).then(function(t){1==t.code?(console.log("有效通话"),e.showCallDetail=!0,e.showTip=!1):(console.log("无效通话"),e.showInvalid=!0,e.showTip=!1)})})},_hovmouseover:function(e,t){0!=e&&1!=e||this.islogin||this.$set(this.contactsList[e],"islogin",!0)},_hovmouseout:function(e,t){0!=e&&1!=e||this.islogin||this.$set(this.contactsList[e],"islogin",!1)},_addEnter:function(e){var t=this;this.$refs[e].validate(function(e){if(e){var a=t.addAlert.text;"手机"==a?t._addEnterMethods(0,t.addAlert.tel):"座机"==a?t._addEnterMethods(1,t.addAlert.camear):"微信"==a?t._addEnterMethods(2,t.addAlert.weixin):"QQ"==a&&t._addEnterMethods(3,t.addAlert.QQ)}})},_addEnterMethods:function(e,t){var a=this.contactsList[e];if(a.more.length>=3)this.$message({message:"一种联系方式，最多添加三条",type:"warning"});else{for(var l=0;l<a.more.length;l++)if(t==a.more[l])return void this.$message({message:"这个联系号码已经有了",type:"warning"});a.more.unshift(t),this.API.addStuContact({stuId:this.stuId,type:e,contact:t}).then(function(e){}).catch(function(e){console.log(e.message)}),this.dialogFormVisible=!1}}}),l),p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"contacts"},[e._l(e.contactsList,function(t,l){return a("div",{key:l,staticClass:"item",class:[e.cardClass[l],{period:!t.more.length}],on:{mouseover:function(a){e._hovmouseover(l,t)},mouseout:function(a){e._hovmouseout(l,t)},click:function(a){e._add(t)}}},[[a("div",{staticClass:"warp"},[a("div",{staticClass:"left"},[a("h1",[e._v(e._s(e.contactsName[t.type]))]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.more.length>1,expression:"item.more.length > 1 "}],staticClass:"next",on:{click:function(a){e._next(t)}}},[a("i",{staticClass:"el-icon-arrow-right"})])]),e._v(" "),t.islogin?e._e():a("div",{directives:[{name:"show",rawName:"v-show",value:t.playCallToogl,expression:"item.playCallToogl"}],class:t.more.length?"palycall":"",on:{click:function(a){e.palycall(t.more[t.urIndex],t)}}},[a("el-button",{staticClass:"button",attrs:{size:"small",icon:"el-icon-service"}},[e._v("呼叫")])],1)]),e._v(" "),a("transition",{attrs:{name:"fade"}},[a("strong",[e._v(e._s(t.more[t.urIndex]))])])],e._v(" "),[a("div",{directives:[{name:"show",rawName:"v-show",value:1==t.islogin,expression:"item.islogin == true"}],staticClass:"login"},[a("p",[e._v("请登录呼叫中心")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"}},[e._v("去登录")])],1)]],2)}),e._v(" "),a("el-dialog",{staticClass:"addAlert",attrs:{title:"添加联系方式",visible:e.dialogFormVisible,width:"38%"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"addAlert",staticClass:"demo-ruleForm",attrs:{model:e.addAlert,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{staticStyle:{"margin-left":"-100px"}},[a("el-radio-group",{model:{value:e.addAlert.text,callback:function(t){e.$set(e.addAlert,"text",t)},expression:"addAlert.text"}},[a("el-radio-button",{attrs:{label:"手机"}}),e._v(" "),a("el-radio-button",{attrs:{label:"座机"}}),e._v(" "),a("el-radio-button",{attrs:{label:"微信"}}),e._v(" "),a("el-radio-button",{attrs:{label:"QQ"}})],1)],1),e._v(" "),"手机"==e.addAlert.text?a("el-form-item",{attrs:{label:"手机号码",prop:"tel"}},[a("el-input",{attrs:{placeholder:"请输入手机号码"},model:{value:e.addAlert.tel,callback:function(t){e.$set(e.addAlert,"tel",t)},expression:"addAlert.tel"}})],1):e._e(),e._v(" "),"座机"==e.addAlert.text?a("el-form-item",{attrs:{label:"座机号码",prop:"camear"}},[a("el-input",{attrs:{placeholder:"请输入座机号码"},model:{value:e.addAlert.camear,callback:function(t){e.$set(e.addAlert,"camear",t)},expression:"addAlert.camear"}})],1):e._e(),e._v(" "),"微信"==e.addAlert.text?a("el-form-item",{attrs:{label:"微信号",prop:"weixin"}},[a("el-input",{attrs:{placeholder:"请输入微信号"},model:{value:e.addAlert.weixin,callback:function(t){e.$set(e.addAlert,"weixin",t)},expression:"addAlert.weixin"}})],1):e._e(),e._v(" "),"QQ"==e.addAlert.text?a("el-form-item",{attrs:{label:"QQ号",prop:"QQ"}},[a("el-input",{attrs:{placeholder:"请输入QQ号"},model:{value:e.addAlert.QQ,callback:function(t){e.$set(e.addAlert,"QQ",t)},expression:"addAlert.QQ"}})],1):e._e(),e._v(" "),a("el-form-item",{staticStyle:{"margin-left":"-100px"}},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"success"},on:{click:function(t){e._addEnter("addAlert")}}},[e._v("确定")])],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{center:"",visible:e.showTip,width:"500px","show-close":!1},on:{"update:visible":function(t){e.showTip=t}}},[a("span",{staticClass:"title-header left",attrs:{slot:"title"},slot:"title"},[e._v("呼叫成功")]),e._v(" "),a("span",[e._v("请在通话结束后，点击“已结束通话”添加跟进信息。")]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",disabled:e.btnDisabled},on:{click:e.overCall}},[e._v(e._s(e.callMessage))])],1)]),e._v(" "),a("el-dialog",{attrs:{center:"",visible:e.showCallDetail,width:"700px"},on:{"update:visible":function(t){e.showCallDetail=t}}},[a("span",{staticClass:"title-header left",attrs:{slot:"title"},slot:"title"},[e._v("新增学员跟进记录-基本信息")]),e._v(" "),a("el-form",{ref:"addCallForm",attrs:{model:e.CallFormData,"label-suffix":"：","label-width":"110px",rules:e.callRule}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"昵称",prop:"nick"}},[a("el-input",{attrs:{placeholder:"请输入昵称"},model:{value:e.CallFormData.nick,callback:function(t){e.$set(e.CallFormData,"nick",t)},expression:"CallFormData.nick"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"性别",prop:"sex"}},[a("el-radio-group",{model:{value:e.CallFormData.sex,callback:function(t){e.$set(e.CallFormData,"sex",t)},expression:"CallFormData.sex"}},[a("el-radio-button",{attrs:{label:"1"}},[e._v("男")]),e._v(" "),a("el-radio-button",{attrs:{label:"2"}},[e._v("女")])],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"地域",prop:"chanceArea"}},[a("el-cascader",{staticClass:"full-width",staticStyle:{width:"100%"},attrs:{options:e.areaoptions,clearable:"",clearable:"",props:e.areaProps,"change-on-select":!0},on:{change:e.handleItemChange},model:{value:e.CallFormData.chanceArea,callback:function(t){e.$set(e.CallFormData,"chanceArea",t)},expression:"CallFormData.chanceArea"}})],1)],1)],1),e._v(" "),a("h3",{staticClass:"title-header margin-bottom-10"},[e._v("沟通情况")]),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"沟通时间",prop:"followTimeMinute"}},[a("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm",format:"yyyy-MM-dd HH:mm",disabled:"",placeholder:"选择日期时间"},model:{value:e.CallFormData.followTimeMinute,callback:function(t){e.$set(e.CallFormData,"followTimeMinute",t)},expression:"CallFormData.followTimeMinute"}})],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"沟通备注",prop:"remark"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.CallFormData.remark,callback:function(t){e.$set(e.CallFormData,"remark",t)},expression:"CallFormData.remark"}})],1),e._v(" "),a("h3",{staticClass:"title-header margin-bottom-10"},[e._v("回访计划")]),e._v(" "),a("el-form-item",{attrs:{label:"回访时间",prop:"backPlan"}},[a("el-col",{attrs:{span:11}},[a("el-select",{staticClass:"full-width",attrs:{placeholder:"回访时间",clearable:""},model:{value:e.CallFormData.backPlan,callback:function(t){e.$set(e.CallFormData,"backPlan",t)},expression:"CallFormData.backPlan"}},e._l(e.EditReturnLis,function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})}))],1),e._v(" "),a("el-col",{directives:[{name:"show",rawName:"v-show",value:4!=e.CallFormData.backPlan,expression:"CallFormData.backPlan!=4"}],staticClass:"margin-left-10",attrs:{span:11}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm",format:"yyyy-MM-dd HH:mm",placeholder:"选择日期时间"},model:{value:e.CallFormData.backTimeMinute,callback:function(t){e.$set(e.CallFormData,"backTimeMinute",t)},expression:"CallFormData.backTimeMinute"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.CallFormData.backRemark,callback:function(t){e.$set(e.CallFormData,"backRemark",t)},expression:"CallFormData.backRemark"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.saveCallDetail}},[e._v("保存")])],1)],1),e._v(" "),a("el-dialog",{attrs:{center:"",visible:e.showInvalid,width:"500px"},on:{"update:visible":function(t){e.showInvalid=t}}},[a("span",{staticClass:"title-header left",attrs:{slot:"title"},slot:"title"},[e._v("无效通话")]),e._v(" "),a("el-form",{ref:"invalidForm",attrs:{model:e.invalidData,"label-suffix":"：","label-width":"110px",rules:e.invalidRule}},[a("el-form-item",{attrs:{label:"无效原因",prop:"isConnect"}},[a("el-select",{staticClass:"full-width",attrs:{placeholder:"请选择",clearable:""},model:{value:e.invalidData.isConnect,callback:function(t){e.$set(e.invalidData,"isConnect",t)},expression:"invalidData.isConnect"}},e._l(e.invalidType,function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"备注",prop:"remark"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.invalidData.remark,callback:function(t){e.$set(e.invalidData,"remark",t)},expression:"invalidData.remark"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.saveInvalid}},[e._v("保存")])],1)],1)],2)},staticRenderFns:[]};var f=a("Z0/y")(m,p,!1,function(e){a("EbJi")},"data-v-0bf0f076",null).exports,_={props:["intentSubject"],components:{},computed:{favorablePrice:function(){this.createOrder.offsetAmount;return Math.round(100*this.createOrder.offsetAmount)/100}},data:function(){var e=this;return{activeName2:"followUp",idCardOptions:v.idCardOptions,contactMsg:[],studentFollowUp:[],followUpDialogFormVisible:!1,reservationsDialogFormVisible:!1,createOrderDialogFormVisible:!1,projectClassType:[],allSchoolInfo:[],schoolReservation:[],myAddFriendList:[],editStudentList:[],orderList:[],studentAllocateList:[],province:[],provinceProps:{value:"id",label:"city",children:"cities"},sellCity:[],wordbook:{followMode:v.studentContact,isConnect:v.isItConnected,isValid:v.communicateResults,backPlan:v.editReturnList,mode:["系统分配","领取","手动分配"]},followUp:{followTimeMinute:"",followMode:"",isConnect:"",isValid:"",remark:"",backPlan:"",backTimeMinute:"",backRemark:""},reservations:{advanceTimeMinute:"",schoolIdFk:"",proIdFk:"",ctIdFk:"",price:"",remark:""},createOrder:{name:"",cardType:"",cardNo:"",regionIdFk:"",proIdFk:"",ctIdFk:"",offsetAmount:"",price:""},rules:{followTimeMinute:[{required:!0,message:"请选择时间",trigger:"change"}],followMode:[{required:!0,message:"请选择联系方式",trigger:"change"}],isConnect:[{required:!0,message:"请选择拨打结果",trigger:"change"}],isValid:[{required:!0,message:"请选择沟通结果",trigger:"change"}]},reservationsRules:{advanceTimeMinute:[{required:!0,message:"请选择时间",trigger:"change"}],schoolIdFk:[{required:!0,message:"请填写报名点",trigger:"change"}],proIdFk:[{required:!0,message:"请选择项目",trigger:"change"}],ctIdFk:[{required:!0,message:"请选择班型",trigger:"change"}]},createOrdeVerificationr:{proIdFk:[{required:!0,message:"请选择项目",trigger:"change"}],ctIdFk:[{required:!0,message:"请选择班型",trigger:"change"}],offsetAmount:[{validator:function(t,a,l){e.createOrder.offsetAmount>=e.createOrder.price?l(new Error("优惠金额不能大于等于价格金额")):e.createOrder.offsetAmount<=0?l(new Error("优惠金额不能小于等于0")):l()},trigger:"blur"},{type:"number",message:"必须为数字值"}],price:[{required:!0,type:"number",message:"必须为数字值"}]}}},watch:{$route:"refreshRoute"},created:function(){this.refreshRoute(),this.qryArea()},methods:{playAudio:function(e){var t=e.target;if("SPAN"===t.tagName){var a=t.parentElement.parentElement.children[1],l=function(){a.load(),t.innerText="播放"};a.removeEventListener("ended",l,!1),a.addEventListener("ended",l,!1),a.paused?(a.play(),t.innerText="暂停"):(a.pause(),t.innerText="播放")}},handleClick:function(e,t){"schoolOrder"==this.activeName2?this.qryStudentAdvanceList():"dealOrder"==this.activeName2?this.qryOrderList():"roamLog"==this.activeName2&&this.qryStudentAllocateList()},refreshRoute:function(){this.userId=this.$store.state.user.userInfo.userId,this.stuId=this.$router.currentRoute.query.stuId,this.getStuFollowDetailList(),this.qryStudentFriendList(),this.qryStudentMdfLogList(),this.getCalllLog()},getCalllLog:function(){var e=this,t=this.$router.currentRoute.query.stuId;this.API.getStuCallDetailList({stuId:t}).then(function(t){e.contactMsg=t.list})},getStuFollowDetailList:function(){var e=this;this.API.getStuFollowDetailList({stuId:this.stuId}).then(function(t){e.studentFollowUp=t.list}).catch(function(e){console.log(e.message)})},followUprEnter:function(e){var t=this;this.$refs[e].validate(function(e){e&&(4==t.followUp.backPlan&&(t.followUp.backTimeMinute=""),t.followUp.stuIdFk=t.stuId,t.API.addStudentFollowDetail(t.followUp).then(function(e){t.$message({message:"录入成功",type:"success"}),t.followUpDialogFormVisible=!1,t.$router.go(0)}).catch(function(e){console.log(e.message)}))})},qryStudentFriendList:function(){var e=this;this.API.qryStudentFriendList({stuId:this.stuId}).then(function(t){e.myAddFriendList=t.list}).catch(function(e){console.log(e.message)})},qryStudentMdfLogList:function(){var e=this;this.API.qryStudentMdfLogList({stuId:this.stuId}).then(function(t){console.log(t),e.editStudentList=t.list}).catch(function(e){console.log(e.message)})},reservationsEnter:function(e){var t=this;this.$refs[e].validate(function(e){e&&(t.reservations.stuIdFk=t.stuId,t.API.addStudentAdvance(t.reservations).then(function(e){t.$message({message:"创建成功",type:"success"}),t.reservationsDialogFormVisible=!1}).catch(function(e){console.log(e.message)}))})},qryAllSchoolInfo:function(){var e=this;this.reservationsDialogFormVisible=!0,this.API.qryAllSchoolInfo().then(function(t){console.log(t.list),e.allSchoolInfo=t.list}).catch(function(e){console.log(e.message)})},qryStudentAdvanceList:function(){var e=this;this.API.qryStudentAdvanceList({stuId:this.stuId}).then(function(t){e.schoolReservation=t.list}).catch(function(e){console.log(e.message)})},getStudentInfo:function(){var e=this;this.createOrderDialogFormVisible=!0,this.API.getStuBaseInfo({stuId:this.stuId}).then(function(t){var a=t.result[0].stuInfo;e.createOrder.name=a.name,e.createOrder.cardType=a.cardType,e.createOrder.cardNo=a.cardNo}).catch(function(e){console.log(e.message)})},createOrderEvent:function(e){var t=this;if(1==this.createOrder.cardType){if(!Object(u.g)(this.createOrder.cardNo))return void this.$message({message:"请输入正确的身份证号",type:"warning"})}else if(2==this.createOrder.cardType&&!Object(u.b)(this.createOrder.cardNo))return void this.$message({message:"港澳台居民身份证",type:"warning"});this.$refs[e].validate(function(e){e&&(t.createOrder.stuIdFk=t.stuId,t.API.addOrder(t.createOrder).then(function(e){t.$message({message:"创建成功",type:"success"}),t.createOrderDialogFormVisible=!1}).catch(function(e){console.log(e.message)}))})},qryOrderList:function(){var e=this;this.API.qryOrderList({stuId:this.stuId}).then(function(t){e.orderList=t.list}).catch(function(e){console.log(e.message)})},qryStudentAllocateList:function(){var e=this;this.API.qryStudentAllocateList({stuId:this.stuId}).then(function(t){e.studentAllocateList=t.list}).catch(function(e){console.log(e.message)})},getProject:function(e){var t=this;this.API.qryAllClassType({proIdFk:e}).then(function(e){t.projectClassType=e.list})},playCallResult:function(e){this.followUp.isValid=0==e?1:0},qryArea:function(e){var t=this;this.API.qryArea({areaId:1}).then(function(e){var a=e.result.map(function(e){return{id:e.id,city:e.province||e.city,cities:[]}});t.province=a})},handleItemChange:function(e,t){var a=this.province;this.API.qryArea({areaId:e[0]||e}).then(function(t){a.forEach(function(a){if(a.id==e[0]||a.id==e)return t.result[0].city?a.cities=t.result:a.cities="",!1})}),this.sellCity[1]?this.createOrder.regionIdFk=this.sellCity[1]:this.createOrder.regionIdFk=this.sellCity[0]}}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"follow-up"},[a("div",{staticClass:"btn"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.followUpDialogFormVisible=!0}}},[e._v("手动录入跟进")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.qryAllSchoolInfo}},[e._v("创建分校预约单")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.getStudentInfo}},[e._v("创建订单")])],1),e._v(" "),a("el-tabs",{staticClass:"fllowup-tab",attrs:{type:"card"},on:{"tab-click":e.handleClick},model:{value:e.activeName2,callback:function(t){e.activeName2=t},expression:"activeName2"}},[a("el-tab-pane",{attrs:{label:"跟进信息",name:"followUp"}},[a("el-row",{staticStyle:{padding:"0px 15px"},attrs:{gutter:20}},[e._l(e.studentFollowUp,function(t,l){return a("el-col",{key:l,attrs:{span:12}},[a("el-card",{staticClass:"box-card"},[t.followMode||0==t.followMode?a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticClass:"title"},[e._v(e._s(e.wordbook.followMode[t.followMode].label||"其他")),a("strong",{directives:[{name:"show",rawName:"v-show",value:1==t.source,expression:"item.source == 1"}]},[e._v("(去电生成)")])]),e._v(" "),a("p",{staticClass:"right",attrs:{type:"text"}},[e._v(e._s(t.followTime))])]):e._e(),e._v(" "),a("ul",{staticClass:"list text item"},[a("li",{directives:[{name:"show",rawName:"v-show",value:0==t.isConnect||1==t.isConnect,expression:"item.isConnect == 0 || item.isConnect == 1"}]},[a("strong",[e._v("拨打结果：")]),e._v(" "),t.isConnect||0==t.isConnect?a("span",[e._v(e._s(e.wordbook.isConnect[t.isConnect].label))]):e._e()]),e._v(" "),a("li",[a("strong",[e._v("沟通结果：")]),e._v(" "),t.isValid||0==t.isValid?a("span",[e._v(e._s(0==t.isValid?"无效果跟进":"有效跟进"))]):e._e()]),e._v(" "),a("li",[a("strong",[e._v("下次回访时间：")]),e._v(" "),a("span",[e._v(e._s(t.backTime))])]),e._v(" "),a("li",[a("strong",[e._v("备注：")]),e._v(" "),a("span",{staticClass:"remarks"},[e._v(e._s(t.remark))])])])])],1)}),e._v(" "),e._l(e.myAddFriendList,function(t,l){return a("el-col",{key:l+200,attrs:{span:12}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticClass:"title"},[e._v("我已加好友")]),e._v(" "),a("p",{staticClass:"right",attrs:{type:"text"}},[e._v(e._s(t.createTime))])]),e._v(" "),a("ul",{staticClass:"list text item"},[a("li",[a("strong",[e._v("操作人：")]),e._v(" "),a("span",[e._v(e._s(t.operateName))])]),e._v(" "),a("li",[a("strong",[e._v("添加方式：")]),e._v(" "),t.type||0==t.type?a("span",[e._v(e._s(e.wordbook.followMode[t.type].label))]):e._e()]),e._v(" "),a("li",[a("strong",[e._v("添加账号：")]),e._v(" "),a("span",[e._v(e._s(t.remark))])])])])],1)}),e._v(" "),e._l(e.editStudentList,function(t,l){return a("el-col",{key:l+300,attrs:{span:12}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticClass:"title"},[e._v("编辑学员信息")]),e._v(" "),a("p",{staticClass:"right",attrs:{type:"text"}},[e._v(e._s(t.createTime))])]),e._v(" "),a("ul",{staticClass:"list text item"},[a("li",[a("strong",[e._v("操作人：")]),e._v(" "),a("span",[e._v(e._s(t.operateName))])]),e._v(" "),t.newMobile||t.mobile?a("li",[a("strong",[e._v("修改手机号：")]),e._v(" "),a("span",[e._v(e._s(t.mobile)+" "),a("i",{staticClass:"el-icon-d-arrow-right"}),e._v(" "+e._s(t.newMobile)+" ")])]):e._e(),e._v(" "),t.newWechat||t.wechat?a("li",[a("strong",[e._v("修改微信号：")]),e._v(" "),a("span",[e._v(e._s(t.wechat)+" "),a("i",{staticClass:"el-icon-d-arrow-right"}),e._v(" "+e._s(t.newWechat)+" ")])]):e._e(),e._v(" "),t.newQq||t.qq?a("li",[a("strong",[e._v("修改QQ：")]),e._v(" "),a("span",[e._v(e._s(t.qq)+" "),a("i",{staticClass:"el-icon-d-arrow-right"}),e._v(" "+e._s(t.newQq)+" ")])]):e._e(),e._v(" "),t.newPhone||t.phone?a("li",[a("strong",[e._v("修改座机号：")]),e._v(" "),a("span",[e._v(e._s(t.phone)+" "),a("i",{staticClass:"el-icon-d-arrow-right"}),e._v(" "+e._s(t.newPhone)+" ")])]):e._e(),e._v(" "),t.proName||t.newProName?a("li",[a("strong",[e._v("修改意向项目：")]),e._v(" "),a("span",[e._v(e._s(t.proName)+" "),a("i",{staticClass:"el-icon-d-arrow-right"}),e._v(" "+e._s(t.newProName)+" ")])]):e._e(),e._v(" "),t.newRegionName||t.regionName?a("li",[a("strong",[e._v("修改机会地域：")]),e._v(" "),a("span",[e._v(e._s(t.regionName)+" "),a("i",{staticClass:"el-icon-d-arrow-right"}),e._v(" "+e._s(t.newRegionName)+" ")])]):e._e()])])],1)})],2)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"分校预约单",name:"schoolOrder"}},[a("el-row",{staticStyle:{padding:"0px 15px"},attrs:{gutter:20}},e._l(e.schoolReservation,function(t,l){return a("el-col",{key:l,attrs:{span:12}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticClass:"title"},[e._v(e._s(t.schoolName))]),e._v(" "),a("p",{staticClass:"right",attrs:{type:"text"}},[e._v(e._s(t.createTime))])]),e._v(" "),a("ul",{staticClass:"list text item"},[a("li",[a("strong",[e._v("推荐项目：")]),e._v(" "),a("span",[e._v(e._s(t.proName))])]),e._v(" "),a("li",[a("strong",[e._v("推荐班型：")]),e._v(" "),a("span",[e._v(e._s(t.cname))])]),e._v(" "),a("li",[a("strong",[e._v("推荐价格：")]),e._v(" "),a("span",[e._v(e._s(t.price))])]),e._v(" "),a("li",[a("strong",[e._v("推荐原因：")]),e._v(" "),a("span",[e._v(e._s(t.remark))])])])])],1)}))],1),e._v(" "),a("el-tab-pane",{attrs:{label:"成交订单",name:"dealOrder"}},[a("el-row",{staticStyle:{padding:"0px 15px"},attrs:{gutter:20}},e._l(e.orderList,function(t,l){return a("el-col",{key:l,attrs:{span:12}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticClass:"title"},[e._v("订单ID:"+e._s(t.sn))]),e._v(" "),a("p",{staticClass:"right",attrs:{type:"text"}},[e._v(e._s(t.createTime))])]),e._v(" "),a("ul",{staticClass:"list text item dealOrder"},[a("li",[a("strong",[e._v("姓名：")]),e._v(" "),a("span",[e._v(e._s(t.name))])]),e._v(" "),a("li",[a("strong",[e._v("大陆身份证：")]),e._v(" "),a("span",[e._v(e._s(t.cardNo))])]),e._v(" "),a("li",[a("strong",[e._v("省市：")]),e._v(" "),a("span",[e._v(e._s(t.regionName))])]),e._v(" "),a("li",[a("strong",[e._v("项目：")]),e._v(" "),a("span",[e._v(e._s(t.proName))])]),e._v(" "),a("li",[a("strong",[e._v("班型：")]),e._v(" "),a("span",[e._v(e._s(t.cname))])]),e._v(" "),a("li",[a("strong",[e._v("价格：")]),e._v(" "),a("span",[e._v(e._s(t.price)+"元")])]),e._v(" "),a("li",[a("strong",[e._v("优惠金额：")]),e._v(" "),a("span",[e._v(e._s(t.offsetAmount)+"元")])]),e._v(" "),a("li",[a("strong",[e._v("实付金额：")]),e._v(" "),a("span",[e._v(e._s(t.amount)+"元")])])])])],1)}))],1),e._v(" "),a("el-tab-pane",{attrs:{label:"通话记录",name:"callRecord"}},[a("el-row",{staticClass:"padding-left-right-20",attrs:{gutter:20}},e._l(e.contactMsg,function(t,l){return a("el-col",{key:l,staticClass:"margin-bottom-10",attrs:{span:12}},[a("el-card",[a("div",{staticClass:"clear",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("咨询师："+e._s(t.userName))]),e._v(" "),a("span",{staticClass:"right"},[e._v(e._s(t.followTime))])]),e._v(" "),a("div",[a("div",{staticClass:"lineHeight-40"},[e._v("拨打结果："+e._s(t.isValid?"有效":"无效"))]),e._v(" "),a("div",{staticClass:"lineHeight-40"},[e._v("通话时长："+e._s(t.duration))]),e._v(" "),a("div",{staticClass:"lineHeight-40"},[e._v("电话录音：\n                "),t.url?a("el-button",{staticClass:"margin-right-10",attrs:{type:"text"},on:{click:e.playAudio}},[e._v("\n                  播放\n                ")]):e._e(),e._v(" "),a("audio",{attrs:{src:t.url,controls:"controls",preload:"",hidden:""}}),e._v(" "),t.url?a("a",{staticClass:"downloadBtn",attrs:{href:t.url,download:"tanzhouCRM"}},[e._v("下载")]):e._e()],1),e._v(" "),a("div",[a("span",{staticClass:"lineHeight-40"},[e._v("沟通备注：")]),e._v(e._s(t.remark))])])])],1)}))],1),e._v(" "),a("el-tab-pane",{attrs:{label:"在线聊天",name:"chatOnline"}},[e._v("暂无接口")]),e._v(" "),a("el-tab-pane",{attrs:{label:"流转日志",name:"roamLog"}},[a("el-row",{staticStyle:{padding:"0px 15px"},attrs:{gutter:20}},e._l(e.studentAllocateList,function(t,l){return a("el-col",{key:l,attrs:{span:12}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticClass:"title"},[e._v(e._s(e.wordbook.mode[t.mode]))]),e._v(" "),a("p",{staticClass:"right",attrs:{type:"text"}},[e._v(e._s(t.createTime))])]),e._v(" "),a("ul",{staticClass:"list text item"},[a("li",[a("strong",[e._v("接待客服：")]),e._v(" "),a("span",[e._v(e._s(t.operateName))])]),e._v(" "),a("li",[a("strong",[e._v("原归属咨询师：")]),e._v(" "),a("span",[e._v(e._s(t.beforeUserName))])]),e._v(" "),a("li",[a("strong",[e._v("分配归属咨询师：")]),e._v(" "),a("span",[e._v(e._s(t.userName))])])])])],1)}))],1)],1),e._v(" "),a("el-dialog",{staticClass:"stick",attrs:{title:"新增跟进记录",visible:e.followUpDialogFormVisible,width:"60%"},on:{"update:visible":function(t){e.followUpDialogFormVisible=t}}},[a("el-form",{ref:"followUp",staticClass:"demo-ruleForm",attrs:{model:e.followUp,rules:e.rules,inline:!0,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"联系时间",prop:"followTimeMinute"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间","value-format":"yyyy-MM-dd HH:mm",format:"yyyy-MM-dd HH:mm","default-time":"12:00:00"},model:{value:e.followUp.followTimeMinute,callback:function(t){e.$set(e.followUp,"followTimeMinute",t)},expression:"followUp.followTimeMinute"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"联系方式",prop:"followMode"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.followUp.followMode,callback:function(t){e.$set(e.followUp,"followMode",t)},expression:"followUp.followMode"}},e._l(e.wordbook.followMode,function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})}))],1),e._v(" "),1==e.followUp.followMode||0==e.followUp.followMode?a("el-form-item",{attrs:{label:"拨打结果",prop:"isConnect"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){e.playCallResult(t)}},model:{value:e.followUp.isConnect,callback:function(t){e.$set(e.followUp,"isConnect",t)},expression:"followUp.isConnect"}},e._l(e.wordbook.isConnect,function(e){return a("el-option",{key:e.id,attrs:{value:e.id,label:e.label}})}))],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"沟通结果",prop:"isValid"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.followUp.isValid,callback:function(t){e.$set(e.followUp,"isValid",t)},expression:"followUp.isValid"}},e._l(e.wordbook.isValid,function(t){return a("el-option",{key:t.id,attrs:{disabled:1==e.followUp.followMode||0==e.followUp.followMode,value:t.id,label:t.label}})}))],1),e._v(" "),a("br"),e._v(" "),a("el-form-item",{attrs:{label:"沟通备注"}},[a("el-input",{staticStyle:{width:"270%"},attrs:{type:"textarea"},model:{value:e.followUp.remark,callback:function(t){e.$set(e.followUp,"remark",t)},expression:"followUp.remark"}})],1),e._v(" "),a("div",{staticClass:"g-title"},[a("h2",[e._v("回访计划")])]),e._v(" "),a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"回访时间"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.followUp.backPlan,callback:function(t){e.$set(e.followUp,"backPlan",t)},expression:"followUp.backPlan"}},e._l(e.wordbook.backPlan,function(e){return a("el-option",{key:e.id,attrs:{value:e.id,label:e.label}})})),e._v(" "),4!==e.followUp.backPlan?a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间","value-format":"yyyy-MM-dd HH:mm",format:"yyyy-MM-dd HH:mm","default-time":"12:00:00"},model:{value:e.followUp.backTimeMinute,callback:function(t){e.$set(e.followUp,"backTimeMinute",t)},expression:"followUp.backTimeMinute"}}):e._e()],1),e._v(" "),a("br"),e._v(" "),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{staticStyle:{width:"270%"},attrs:{type:"textarea"},model:{value:e.followUp.backRemark,callback:function(t){e.$set(e.followUp,"backRemark",t)},expression:"followUp.backRemark"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"100%","text-align":"center"}},[a("el-button",{on:{click:function(t){e.followUpDialogFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"success"},on:{click:function(t){e.followUprEnter("followUp")}}},[e._v("确定")])],1)],1)],1),e._v(" "),a("el-dialog",{staticClass:"stick",attrs:{title:"创建分校预约单",visible:e.reservationsDialogFormVisible,width:"60%"},on:{"update:visible":function(t){e.reservationsDialogFormVisible=t}}},[a("el-form",{ref:"reservations",staticClass:"demo-ruleForm",attrs:{model:e.reservations,rules:e.reservationsRules,inline:!0,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"预约时间",prop:"advanceTimeMinute"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间","value-format":"yyyy-MM-dd HH:mm",format:"yyyy-MM-dd HH:mm","default-time":"12:00:00"},model:{value:e.reservations.advanceTimeMinute,callback:function(t){e.$set(e.reservations,"advanceTimeMinute",t)},expression:"reservations.advanceTimeMinute"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"预约校区",prop:"schoolIdFk"}},[a("el-select",{attrs:{placeholder:"请选择分校"},model:{value:e.reservations.schoolIdFk,callback:function(t){e.$set(e.reservations,"schoolIdFk",t)},expression:"reservations.schoolIdFk"}},e._l(e.allSchoolInfo,function(e){return a("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"推荐项目",prop:"proIdFk"}},[a("el-select",{attrs:{placeholder:"请选择项目"},on:{change:function(t){e.getProject(t)}},model:{value:e.reservations.proIdFk,callback:function(t){e.$set(e.reservations,"proIdFk",t)},expression:"reservations.proIdFk"}},e._l(e.intentSubject,function(e){return a("el-option",{key:e.proId,attrs:{value:e.proId,label:e.proName}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"推荐班型",prop:"ctIdFk"}},[a("el-select",{attrs:{placeholder:"请选择班型"},model:{value:e.reservations.ctIdFk,callback:function(t){e.$set(e.reservations,"ctIdFk",t)},expression:"reservations.ctIdFk"}},e._l(e.projectClassType,function(e){return a("el-option",{key:e.ctId,attrs:{value:e.ctId,label:e.cname}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"推荐价格"}},[a("el-input",{model:{value:e.reservations.price,callback:function(t){e.$set(e.reservations,"price",t)},expression:"reservations.price"}})],1),e._v(" "),a("br"),e._v(" "),a("el-form-item",{attrs:{label:"推荐原因"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.reservations.remark,callback:function(t){e.$set(e.reservations,"remark",t)},expression:"reservations.remark"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"100%","text-align":"center"}},[a("el-button",{on:{click:function(t){e.reservationsDialogFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"success"},on:{click:function(t){e.reservationsEnter("reservations")}}},[e._v("确定")])],1)],1)],1),e._v(" "),a("el-dialog",{staticClass:"stick",attrs:{title:"创建订单",visible:e.createOrderDialogFormVisible,width:"50%"},on:{"update:visible":function(t){e.createOrderDialogFormVisible=t}}},[a("el-form",{ref:"createOrder",staticClass:"demo-ruleForm",attrs:{model:e.createOrder,rules:e.createOrdeVerificationr,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"姓名："}},[a("el-input",{model:{value:e.createOrder.name,callback:function(t){e.$set(e.createOrder,"name",t)},expression:"createOrder.name"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"身份证："}},[a("el-select",{staticStyle:{width:"35%"},attrs:{placeholder:"请选择："},model:{value:e.createOrder.cardType,callback:function(t){e.$set(e.createOrder,"cardType",t)},expression:"createOrder.cardType"}},e._l(e.idCardOptions,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.id}})})),e._v(" "),a("el-input",{staticStyle:{width:"45%"},model:{value:e.createOrder.cardNo,callback:function(t){e.$set(e.createOrder,"cardNo",t)},expression:"createOrder.cardNo"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"售卖省市："}},[a("el-cascader",{attrs:{options:e.province,"change-on-select":!0,clearable:"",props:e.provinceProps},on:{change:function(t){e.handleItemChange(t)}},model:{value:e.sellCity,callback:function(t){e.sellCity=t},expression:"sellCity"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"选择项目：",prop:"proIdFk"}},[a("el-select",{attrs:{placeholder:"请选择项目"},on:{change:function(t){e.getProject(t)}},model:{value:e.createOrder.proIdFk,callback:function(t){e.$set(e.createOrder,"proIdFk",t)},expression:"createOrder.proIdFk"}},e._l(e.intentSubject,function(e){return a("el-option",{key:e.proId,attrs:{value:e.proId,label:e.proName}})}))],1),e._v(" "),a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"选择班型：",prop:"ctIdFk"}},[a("el-select",{attrs:{placeholder:"请选择班型"},model:{value:e.createOrder.ctIdFk,callback:function(t){e.$set(e.createOrder,"ctIdFk",t)},expression:"createOrder.ctIdFk"}},e._l(e.projectClassType,function(e){return a("el-option",{key:e.ctId,attrs:{value:e.ctId,label:e.cname}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"价格：",prop:"price"}},[a("el-input",{attrs:{type:"",placeholder:"请输入价格"},model:{value:e.createOrder.price,callback:function(t){e.$set(e.createOrder,"price",e._n(t))},expression:"createOrder.price"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"优惠金额：",prop:"offsetAmount"}},[a("el-input",{model:{value:e.createOrder.offsetAmount,callback:function(t){e.$set(e.createOrder,"offsetAmount",e._n(t))},expression:"createOrder.offsetAmount"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"实付金额："}},[a("span",[e._v(e._s(e.createOrder.price-e.favorablePrice)+"元")])]),e._v(" "),a("el-form-item",{staticStyle:{width:"100%","text-align":"center"}},[a("el-button",{on:{click:function(t){e.createOrderDialogFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"success"},on:{click:function(t){e.createOrderEvent("createOrder")}}},[e._v("确定")])],1)],1)],1)],1)},staticRenderFns:[]};var b=a("Z0/y")(_,h,!1,function(e){a("fEE/"),a("cUBD")},"data-v-0addba7d",null).exports,g=a("IHPB"),y=a.n(g),k={props:["intentSubject"],data:function(){return{stuInfo:"",dialogFormVisible:!1,dialogFormVisibleFriend:!1,dialogFormEditReturn:!1,stutentInfo:{},stuCardInfo:{},showBackPlanId:0,cityIdFk:[],friendlist:[],giveUpAlert:{region:"",Friendregion:"",way:""},EditReturn:{backPlan:"",backTime:"",backRemark:"",id:-1},rules:{region:[{required:!0,message:"请选择退回原因",trigger:"change"}],Friendregion:[{required:!0,message:"请选择账号",trigger:"change"}],way:[{required:!0,message:"请选择",trigger:"change"}],returnOff:[{required:!0,message:"请选择回访时间",trigger:"change"}]},idOptions:v.idOptions,intentLubjectList:v.intentLubjectList,degreeList:v.degreeList,sexList:v.sexList,levelList:v.levelList,classtimeList:v.classtimeList,cardNoList:v.cardNoList,editReturnList:v.editReturnList,backOut:v.backOut}},computed:{studentIntention:function(){var e=this.stuInfo.degree;return{value:parseInt(e)>=-1?[0,5,4,2,.5][e]:0,label:parseInt(e)>=-1?["未知","强","中","弱","无"][e]:"无"}}},watch:{$route:"getrouterQuery"},created:function(){this.getrouterQuery()},methods:c()({getrouterQuery:function(){this.userId=this.$store.state.user.userInfo.userId,this.stuId=this.$router.currentRoute.query.stuId,this.isAddFriends=this.$router.currentRoute.query.friend,this.getStuFollowDetail(),this.getStuBaseInfo()},intentSubjectSum:function(){for(var e=0;e<this.intentSubject.length;e++)if(this.stuInfo.intentSubject==this.intentSubject[e].proId)return this.intentSubject[e].proName},showBackPlan:function(e){this.showBackPlanId=e}},Object(d.c)(["STUDENT_INFO"]),{getStuBaseInfo:function(){var e=this;this.API.getStuBaseInfo({stuId:this.stuId}).then(function(t){e.stuInfo=t.result[0].stuInfo,e.STUDENT_INFO(e.stuInfo)}).catch(function(e){console.log(e.message)})},addFriends:function(){this.giveUpAlert.way="",this.giveUpAlert.Friendregion="",0!=this.isAddFriends?this.dialogFormVisibleFriend=!0:this.$message({message:"你已经添加该学员为好友了！",type:"warning"})},addFriendTab:function(){var e=this,t=-1;t="微信"==this.giveUpAlert.way?2:3,this.API.qryStuContact({stuId:this.stuId}).then(function(a){"微信"==e.giveUpAlert.way?e.friendlist=[].concat(y()(a.result[t].more),y()(a.result[0].more)):e.friendlist=a.result[t].more,e.giveUpAlert.Friendregion=""}).catch(function(e){console.log(e.message)})},_FriendrEnter:function(e){var t=this,a=-1;this.$refs[e].validate(function(e){if(e){var l=t.userId,s=t.stuId;a="微信"==t.giveUpAlert.way?2:3;var i=t.giveUpAlert.Friendregion;t.API.addFriend({userIdFk:l,stuIdFk:s,type:a,remark:i}).then(function(e){t.$message({message:"添加成功",type:"success"}),t.dialogFormVisibleFriend=!1}).catch(function(e){console.log(e.message)})}})},edit:function(){this.$router.push({path:"edit-student",query:{stuId:this.stuId}})},_giveUpEnter:function(e){var t=this;this.$refs[e].validate(function(e){e&&(t.API.delBelongTo({stuId:t.stuId}).then(function(e){t.$message({message:"操作成功",type:"success"})}).catch(function(e){console.log(e.message)}),t.dialogFormVisible=!1)})},getStuFollowDetail:function(){var e=this;this.API.getStuFollowDetail({stuId:this.stuId,userId:this.userId}).then(function(t){e.EditReturn.backPlan=t.result.backPlan,e.EditReturn.backTime=t.result.backTime,e.EditReturn.backRemark=t.result.backRemark,e.EditReturn.id=t.result.id}).catch(function(t){for(var a in e.EditReturn)e.EditReturn[a]=""})},EditReturnUp:function(){String(this.EditReturn.backPlan)?(this.API.mdfStuFollowDetail(this.EditReturn).then(function(e){}).catch(function(e){console.log(e.message)}),this.dialogFormEditReturn=!1):this.$message({message:"回访时间不能为空",type:"warning"})}})},w={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"studentInfo"},[a("div",{staticClass:"item"},[a("div",{staticClass:"studentHeader"},[e._m(0),e._v(" "),a("div",{staticClass:"progress"},[a("span",[e._v("学员意向度：")]),e._v(" "),a("el-rate",{staticClass:"xinxin",attrs:{disabled:"","show-score":"","text-color":"#40b3ff","score-template":e.studentIntention.label},model:{value:e.studentIntention.value,callback:function(t){e.$set(e.studentIntention,"value",t)},expression:"studentIntention.value"}})],1),e._v(" "),a("div",{staticClass:"btn-right"},[a("el-button",{staticClass:"btn",attrs:{type:"text",size:"small"},on:{click:function(t){e.dialogFormVisible=!0}}},[e._v("放弃归属")]),e._v(" "),a("el-button",{staticClass:"btn",attrs:{type:"text",size:"small"},on:{click:e.addFriends}},[e._v("我已加为好友")]),e._v(" "),a("el-button",{staticClass:"btn",attrs:{type:"text",size:"small"},on:{click:e.edit}},[e._v("编辑学员信息")])],1)]),e._v(" "),a("ul",{staticClass:"list"},[a("li",[a("strong",[e._v("学员ID：")]),e._v(" "),a("span",[e._v(e._s(e.stuInfo.stuId))])]),e._v(" "),a("li",[a("strong",[e._v("推广类型：")]),e._v(" "),a("span",[e._v(e._s(e.stuInfo.extendType||"无"))])]),e._v(" "),a("li",[a("strong",[e._v("意向项目：")]),e._v(" "),a("span",[e._v(e._s(e.intentSubjectSum()))])]),e._v(" "),a("li",[a("strong",[e._v("机会地域：")]),e._v(" "),a("span",[e._v(e._s(e.stuInfo.intentProvinceName)+" "+e._s(e.stuInfo.intentCityName))])]),e._v(" "),a("li",[a("strong",[e._v("创建时间：")]),e._v(" "),a("span",[e._v(e._s(e.stuInfo.createTime))])]),e._v(" "),a("li",[a("strong",[e._v("分配时间：")]),e._v(" "),a("span",[e._v(e._s(e.stuInfo.lastAllocTime))])]),e._v(" "),a("li",[a("strong",[e._v("最后跟进时间：")]),e._v(" "),a("span",[e._v(e._s(e.stuInfo.lastFollowTime||"无"))])]),e._v(" "),a("li",[a("strong",[e._v("最近有效跟进：")]),e._v(" "),a("span",[e._v(e._s(e.stuInfo.lastValidFollowTime||"无"))])])])]),e._v(" "),a("div",{staticClass:"item"},[e._m(1),e._v(" "),a("ul",{staticClass:"list"},[a("li",[a("strong",[e._v("昵称：")]),e._v(" "),a("span",[e._v(e._s(e.stuInfo.nick||"无"))])]),e._v(" "),a("li",[a("strong",[e._v("真实姓名：")]),e._v(" "),a("span",[e._v(e._s(e.stuInfo.name||"无"))])]),e._v(" "),a("li",[a("strong",[e._v("学员地域：")]),e._v(" "),a("span",[e._v(e._s(e.stuInfo.provinceName)+" "+e._s(e.stuInfo.cityName))])]),e._v(" "),a("li",[a("strong",[e._v("性别：")]),e._v(" "),e.stuInfo.sex||0==e.stuInfo.sex?a("span",[e._v(e._s(e.sexList[e.stuInfo.sex-1].label))]):a("span",[e._v("无")])]),e._v(" "),a("li",[a("strong",[e._v("年龄：")]),e._v(" "),a("span",[e._v(e._s(e.stuInfo.age||"无"))])]),e._v(" "),a("li",[a("strong",[e._v(e._s(e.stuInfo.cardType&&1!=e.stuInfo.cardType?"港澳台居民证件：":"中国大陆身份证："))]),e._v(" "),a("span",[e._v(e._s(e.stuInfo.cardNo||"无"))])])])]),e._v(" "),a("div",{staticClass:"item"},[e._m(2),e._v(" "),a("ul",{staticClass:"list"},[a("li",[a("strong",[e._v("身份：")]),e._v(" "),e.stuInfo.identity||0==e.stuInfo.identity?a("span",[e._v(e._s(e.idOptions[e.stuInfo.identity].label))]):a("span",[e._v("无")])]),e._v(" "),a("li",[a("strong",[e._v("水平：")]),e._v(" "),e.stuInfo.level||0==e.stuInfo.level?a("span",[e._v(e._s(e.levelList[e.stuInfo.level].label))]):a("span",[e._v("无")])]),e._v(" "),a("li",[a("strong",[e._v("计划上课时间：")]),e._v(" "),e.stuInfo.classTime||0==e.stuInfo.classTime?a("span",[e._v(e._s(e.classtimeList[e.stuInfo.classTime].label))]):a("span",[e._v("无")])]),e._v(" "),a("li",[a("strong",[e._v("开始学习时间：")]),e._v(" "),a("span",[e._v(e._s(e.stuInfo.startStudyTime||"无"))])]),e._v(" "),a("li",[a("strong",[e._v("学习用途：")]),e._v(" "),a("span",{staticClass:"study-use"},[e._v(e._s(e.stuInfo.purpose||"无"))])])])]),e._v(" "),a("div",{staticClass:"item"},[e._m(3),e._v(" "),a("div",{staticClass:"pay"},[a("ul",{staticClass:"list"},[a("li",{staticStyle:{width:"100%","text-align":"left"}},[a("strong",{staticStyle:{width:"150px"}},[e._v("下次回访时间：")]),e._v(" "),a("span",[e.EditReturn.backPlan||0===e.EditReturn.backPlan?a("span",[e._v(e._s(e.editReturnList[e.EditReturn.backPlan].label||"无"))]):e._e(),e._v("\n              \n            "),a("i",{directives:[{name:"show",rawName:"v-show",value:4!==e.EditReturn.backPlan,expression:"EditReturn.backPlan !== 4"}]},[e._v(e._s(e.EditReturn.backTime))])])]),e._v(" "),a("li",{staticStyle:{width:"100%","text-align":"left"}},[a("strong",{staticStyle:{width:"150px"}},[e._v("回访备注：")]),e._v(" "),a("span",{staticStyle:{width:"calc(100% - 150px)"}},[e._v(e._s(e.EditReturn.backRemark||"无"))])])]),e._v(" "),e.EditReturn.id?a("el-button",{staticClass:"eidtPlan",attrs:{type:"primary",size:"small"},on:{click:function(t){e.dialogFormEditReturn=!0}}},[e._v("修改计划")]):e._e()],1)]),e._v(" "),a("el-dialog",{staticClass:"giveUpAlert",attrs:{title:"放弃归属",visible:e.dialogFormVisible,width:"45%"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"giveUpAlert",staticClass:"demo-ruleForm",attrs:{model:e.giveUpAlert,rules:e.rules,"label-width":"100px"}},[a("p",[e._v("放弃归属后，其他咨询师可在公海库中领取该学员，确认进行此操作？")]),e._v(" "),a("el-form-item",{attrs:{label:"退回原因",prop:"region"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择退回原因"},model:{value:e.giveUpAlert.region,callback:function(t){e.$set(e.giveUpAlert,"region",t)},expression:"giveUpAlert.region"}},e._l(e.backOut,function(e){return a("el-option",{key:e.id,attrs:{value:e.id,label:e.label}})}))],1),e._v(" "),a("el-form-item",{staticStyle:{"margin-left":"-100px"}},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"success"},on:{click:function(t){e._giveUpEnter("giveUpAlert")}}},[e._v("确定")])],1)],1)],1),e._v(" "),a("el-dialog",{staticClass:"giveUpAlert",attrs:{title:"你已经添加该学员为好友？",visible:e.dialogFormVisibleFriend,width:"45%"},on:{"update:visible":function(t){e.dialogFormVisibleFriend=t}}},[a("el-form",{ref:"addFriends",staticClass:"demo-ruleForm",attrs:{model:e.giveUpAlert,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{staticStyle:{"text-align":"left"},attrs:{label:"添加方式",prop:"way"}},[a("el-radio-group",{on:{change:e.addFriendTab},model:{value:e.giveUpAlert.way,callback:function(t){e.$set(e.giveUpAlert,"way",t)},expression:"giveUpAlert.way"}},e._l(["微信","QQ"],function(e,t){return a("el-radio-button",{key:t,attrs:{label:e,value:t}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"添加账号",prop:"Friendregion"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.giveUpAlert.Friendregion,callback:function(t){e.$set(e.giveUpAlert,"Friendregion",t)},expression:"giveUpAlert.Friendregion"}},e._l(e.friendlist,function(e,t){return a("el-option",{key:t,attrs:{value:e,label:e}})}))],1),e._v(" "),a("el-form-item",{staticStyle:{"margin-left":"-100px"}},[a("el-button",{on:{click:function(t){e.dialogFormVisibleFriend=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"success"},on:{click:function(t){e._FriendrEnter("addFriends")}}},[e._v("确定")])],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"修改回访计划",visible:e.dialogFormEditReturn,width:"45%"},on:{"update:visible":function(t){e.dialogFormEditReturn=t}}},[a("el-form",{staticClass:"demo-ruleForm"},[a("el-form-item",{attrs:{label:"回访时间："}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){e.showBackPlan(t)}},model:{value:e.EditReturn.backPlan,callback:function(t){e.$set(e.EditReturn,"backPlan",t)},expression:"EditReturn.backPlan"}},e._l(e.editReturnList,function(e,t){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})})),e._v(" "),4!=e.showBackPlanId?a("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm",format:"yyyy-MM-dd HH:mm",placeholder:"选择日期"},model:{value:e.EditReturn.backTime,callback:function(t){e.$set(e.EditReturn,"backTime",t)},expression:"EditReturn.backTime"}}):e._e()],1),e._v(" "),a("el-form-item",{attrs:{label:"回访备注："}},[a("el-input",{staticStyle:{width:"74%"},attrs:{type:"textarea"},model:{value:e.EditReturn.backRemark,callback:function(t){e.$set(e.EditReturn,"backRemark",t)},expression:"EditReturn.backRemark"}})],1),e._v(" "),a("el-form-item",{staticClass:"btn-right"},[a("el-button",{on:{click:function(t){e.dialogFormEditReturn=!1,e.getStuFollowDetail()}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"success"},on:{click:function(t){e.EditReturnUp()}}},[e._v("确定")])],1)],1)],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("h4",{staticClass:"slideTitle"},[t("span"),this._v(" "),t("h3",[this._v("学员概要")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"studentHeader"},[t("h4",{staticClass:"slideTitle"},[t("span"),this._v(" "),t("h3",[this._v("基本信息")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"studentHeader"},[t("h4",{staticClass:"slideTitle"},[t("span"),this._v(" "),t("h3",[this._v("详细信息")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"studentHeader"},[t("h4",{staticClass:"slideTitle"},[t("span"),this._v(" "),t("h3",[this._v("回访计划")])])])}]};var I={props:["intentSubject"],components:{"v-contacts":f,"v-studentInfo":a("Z0/y")(k,w,!1,function(e){a("DKbH")},"data-v-020273d0",null).exports,"v-followup":b},created:function(){this.$store.state.workbench.status=!1}},C={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{},[a("v-contacts"),e._v(" "),e.intentSubject.length?a("v-studentInfo",{attrs:{intentSubject:e.intentSubject}}):e._e(),e._v(" "),e.intentSubject.length?a("v-followup",{attrs:{intentSubject:e.intentSubject}}):e._e()],1)},staticRenderFns:[]};var F=a("Z0/y")(I,C,!1,function(e){a("JsyM")},"data-v-2a662212",null);t.default=F.exports},DKbH:function(e,t){},EbJi:function(e,t){},JsyM:function(e,t){},cUBD:function(e,t){},"fEE/":function(e,t){},iA2B:function(e,t){e.exports={idOptions:[{id:0,label:"未知"},{id:1,label:"在职"},{id:2,label:"学生"},{id:3,label:"自雇"},{id:4,label:"待业"},{id:5,label:"自由职业"},{id:6,label:"家庭主妇"},{id:7,label:"其他"}],intentLubjectList:[{id:0,label:"未知"},{id:1,label:"相关行业"},{id:2,label:"非相关行业"},{id:3,label:"年级：初中,高中,大学"},{id:4,label:"专业"},{id:5,label:"淘宝店"},{id:6,label:"实体店"},{id:7,label:"刚毕业"},{id:8,label:"辞职、失业"}],degreeList:[{id:1,label:"强"},{id:2,label:"中"},{id:3,label:"弱"},{id:4,label:"无"}],sexList:[{id:1,label:"男"},{id:2,label:"女"}],levelList:[{id:0,label:"未知"},{id:1,label:"零基础"},{id:2,label:"有点基础"},{id:3,label:"基础较好"}],cardNoList:[{id:1,label:"中国大陆身份证"},{id:2,label:"港澳台居民身份证"}],classtimeList:[{id:0,label:"未知"},{id:1,label:"晚上"},{id:2,label:"周末"},{id:3,label:"业余时间"}],extendType:[{id:0,label:"未知"},{id:1,label:"百度推广"}],editReturnList:[{id:0,label:"隔天联系"},{id:1,label:"约定时间联系"},{id:2,label:"稍后在联系"},{id:3,label:"今晚联系"},{id:4,label:"不需要了"}],isItConnected:[{id:0,label:"接通"},{id:1,label:"无人接听"},{id:2,label:"空号"},{id:3,label:"停机/错号"}],studentContact:[{id:0,label:"手机"},{id:1,label:"座机"},{id:2,label:"微信"},{id:3,label:"QQ"}],communicateResults:[{id:0,label:"无效沟通"},{id:1,label:"有效沟通"}],backOut:[{id:0,label:"空号错号停机"},{id:1,label:"三次无们接听"},{id:2,label:"不符合报名条件"},{id:3,label:"没有符合的产品"},{id:4,label:"已报名其他机构"},{id:5,label:"号码错误"},{id:6,label:"明确表态不需要"},{id:7,label:"谈合作"},{id:8,label:"招聘"},{id:9,label:"打过去没有咨询过"}]}}});
//# sourceMappingURL=6.2d5acab9961e02d4e9ab.js.map