webpackJsonp([17],{CIAd:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("4YfN"),l=a.n(s),n=a("9rMa"),i=a("3cXf"),o=a.n(i),r=a("s0MJ"),c={components:{},props:{listData:{type:Array},scheduleOptions:{type:Array},params:{type:Object},weekName:{type:Array},weekDays:{type:Array}},data:function(){return{list:this.listData}},computed:{},created:function(){},methods:{getList:function(){var e=this;this.API.qrySchList(this.params).then(function(t){console.log(t),e.list=t.result,e.list.length>1&&e.list.sort(function(e,t){return e.sort>t.sort}),console.log(e.list),console.log(e.list)})},disabledDate:function(e){console.log(e)},updateTable:function(){this.isEdit=!0,this.tableParams=JSON.parse(o()(this.list)),console.log(this.tableParams)},moveItem2:function(e,t){var a=this.list;if("up"===e){if(t){var s=a.splice(t,1);a.splice(t-1,0,s[0]),console.log(a,t,s)}}else if(t<a.length-1){var l=a.splice(t,1);a.splice(t+1,0,l[0]),console.log(a,t,l)}},save:function(){var e=this;console.log(this.list),this.list.forEach(function(e,t){e.sort=t+1}),console.log(this.list);var t=this.params;t.schList=this.list,this.API.mdfSchList(t).then(function(t){console.log(t),e.$emit("change",!0)})},cancel:function(){this.$emit("change")},copyLastWeek:function(){var e=this,t=new Date(this.params.beginDate).getTime(),a=t-6048e5;console.log(t);var s={deptId:this.params.deptId,beginDate:Object(r.a)(a/1e3,"yyyy-MM-dd")};this.API.qrySchList(s).then(function(t){console.log(t),e.list=t.result,console.log(e.list)})},tableRowClassName:function(e){e.row;if(!e.rowIndex)return"tb-hd"}}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.list?a("div",{},[a("el-table",{staticClass:"table tac",attrs:{stripe:"",border:"",data:e.list,"current-row-key":"index","row-class-name":e.tableRowClassName,"header-row-class-name":"tb-hd"}},[a("el-table-column",{attrs:{label:"优先级",type:"index",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"sort-wrap"},[a("span",{staticClass:"sort-num"},[e._v("\n        "+e._s(t.$index+1)+"\n        ")]),e._v(" "),a("span",{staticClass:"icon-move"},[a("i",{staticClass:"el-input__icon el-icon-caret-top",attrs:{title:"上移"},on:{click:function(a){e.moveItem2("up",t.$index)}}}),e._v(" "),a("i",{staticClass:"el-input__icon el-icon-caret-bottom",attrs:{title:"下移"},on:{click:function(a){e.moveItem2("down",t.$index)}}})])])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"userName",label:"坐席",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{label:"计划分配数",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{staticClass:"tac",staticStyle:{width:"70px"},model:{value:t.row.allotPlanNum,callback:function(a){e.$set(t.row,"allotPlanNum",a)},expression:"scope.row.allotPlanNum"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"alreadyPlanNum",label:"已分配数"}}),e._v(" "),e._l(e.weekName,function(t,s){return a("el-table-column",{key:s,attrs:{label:e.weekDays[s]}},[a("el-table-column",{attrs:{label:"星期"+t},scopedSlots:e._u([{key:"default",fn:function(l){return[a("el-select",{class:{red:"休息"===t.rangeName},attrs:{placeholder:"请选择"},model:{value:l.row.schedu[s],callback:function(t){e.$set(l.row.schedu,s,t)},expression:"scope.row.schedu[key]"}},e._l(e.scheduleOptions,function(e,t){return a("el-option",{key:t,attrs:{label:e.rangeName,value:e.rangeId}})}))]}}])})],1)})],2),e._v(" "),a("div",[a("div",{staticClass:"mt20 tar"},[a("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("保存")]),e._v(" "),a("el-button",{attrs:{type:"default"},on:{click:e.cancel}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"success"},on:{click:e.copyLastWeek}},[e._v("复制上周")])],1)])],1):e._e()},staticRenderFns:[]};var d={components:{UpdateTable:a("Z0/y")(c,u,!1,function(e){a("rBUH")},"data-v-255ea8d7",null).exports},data:function(){return{deptId:[],beginDate:null,params:{deptId:"",beginDate:""},departmentTree:[],departmentProps:{label:"label",value:"id"},list:null,isEditing:!1,scheduleOptions:[],groupOptions:[{id:5,label:"成考网销1组"},{id:6,label:"成考网销2组"},{id:7,label:"成考网销3组"}],weekName:"一二三四五六日".split(""),rules:{deptId:[{required:!0,message:"请选择小组",trigger:"change"}],beginDate:[{required:!0,message:"请选择开始日期",trigger:"change"}]}}},computed:l()({},Object(n.d)({userInfo:function(e){return e.user.userInfo}}),{disableEditing:function(){if(!this.endDate)return!1;var e=(new Date).getTime(),t=new Date(this.endDate).getTime();return console.log(e>t),e>t},endDate:function(){if(!this.beginDate)return"";var e=this.beginDate.getTime()+5184e5;return Object(r.a)(e/1e3,"yyyy-MM-dd")},weekDays:function(){var e=[];if(!this.beginDate)return e;for(var t=this.beginDate.getTime(),a=0;a<7;a++){var s=t+864e5*a;e.push(Object(r.a)(s/1e3,"yyyy-MM-dd"))}return e}}),watch:{deptId:function(e){e&&e.length&&(this.params.deptId=e[e.length-1])},beginDate:function(e){this.params.beginDate=Object(r.a)(new Date(e)/1e3,"yyyy-MM-dd")}},created:function(){var e=this;this.API.qryDept({deptId:this.userInfo.deptIdFk}).then(function(t){console.log(t),e.departmentTree=t.result})},methods:{beforeSearch:function(e){var t=this;this.$refs[e].validate(function(e){e?(t.API.qryRgeList({deptId:t.params.deptId}).then(function(e){console.log(e),t.scheduleOptions=e.result,t.scheduleOptions&&t.scheduleOptions.length&&t.scheduleOptions.push({rangeId:0,rangeName:"休息"})}),t.search()):console.log("submit error!")})},search:function(){var e=this;this.API.qrySchList(this.params).then(function(t){console.log(t),e.list=t.result,e.list.length>1&&e.list.sort(function(e,t){return e.sort>t.sort})}).catch(function(t){e.list=[]})},getItemName:function(e){for(var t=this.scheduleOptions,a=0;a<t.length;a++)if(t[a].rangeId==e)return t[a].rangeName},disabledDate:function(e){console.log(e)},updateTable:function(){this.isEditing=!0},save:function(){console.log(this.list)},copy:function(){console.log(this.tableData)},handleChange:function(e){console.log(e),this.isEditing=!1,this.search()},tableRowClassName:function(e){e.row;if(!e.rowIndex)return"tb-hd"}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"main-inner"},[a("bread-crumb",[a("h2",[e._v("排班管理")])]),e._v(" "),a("el-form",{ref:"searchForm",staticClass:"demo-form-inline",attrs:{model:e.params,rules:e.rules,inline:!0}},[a("el-form-item",{attrs:{label:"小组",prop:"deptId"}},[a("el-cascader",{staticClass:"mr20",attrs:{options:e.departmentTree,props:e.departmentProps,"show-all-levels":!1,"change-on-select":!1,"expand-trigger":"hover"},model:{value:e.deptId,callback:function(t){e.deptId=t},expression:"deptId"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"排班日期",prop:"beginDate"}},[a("el-date-picker",{staticStyle:{width:"150px"},attrs:{type:"week",format:"yyyy-MM-dd",clearable:!1,editable:!1,placeholder:"开始日期"},model:{value:e.beginDate,callback:function(t){e.beginDate=t},expression:"beginDate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"至"}},[a("el-input",{staticStyle:{width:"150px"},attrs:{value:e.endDate,disabled:"",placeholder:"结束日期"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"success"},on:{click:function(t){e.beforeSearch("searchForm")}}},[e._v("查询")])],1),e._v(" "),e.isEditing||e.disableEditing?e._e():a("div",{staticClass:"fr"},[e.$root.perm.PBGL_BJPB&&e.list&&e.list.length?a("el-button",{attrs:{type:"primary"},on:{click:e.updateTable}},[e._v("编辑排班表")]):e._e()],1)],1),e._v(" "),e.isEditing?a("update-table",{attrs:{"list-data":e.list,"schedule-options":e.scheduleOptions,params:e.params,"week-name":e.weekName,"week-days":e.weekDays},on:{change:e.handleChange}}):[e.list?a("el-table",{staticClass:"table tac",attrs:{stripe:"",border:"",data:e.list,"row-class-name":e.tableRowClassName,"header-row-class-name":"tb-hd"}},[a("el-table-column",{attrs:{label:"优先级",type:"index",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{prop:"userName",label:"坐席",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"allotPlanNum",label:"计划分配数",width:"130"}}),e._v(" "),a("el-table-column",{attrs:{prop:"alreadyPlanNum",label:"已分配数"}}),e._v(" "),e._l(e.weekName,function(t,s){return a("el-table-column",{key:s,attrs:{label:e.weekDays[s]}},[a("el-table-column",{attrs:{label:"星期"+t},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.schedu[s]?e.getItemName(t.row.schedu[s]):"休息")+"\n        ")]}}])})],1)})],2):e._e()]],2)},staticRenderFns:[]};var h=a("Z0/y")(d,p,!1,function(e){a("pzIs")},"data-v-bf6584bc",null);t.default=h.exports},pzIs:function(e,t){},rBUH:function(e,t){}});
//# sourceMappingURL=17.9ae3df1ec39bfe21eb42.js.map